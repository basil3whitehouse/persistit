<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_17) on Sun Mar 24 13:36:52 EDT 2013 -->
<meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
<title>Accumulator (akiban-persistit 3.2.7 API)</title>
<meta name="date" content="2013-03-24">
<link rel="stylesheet" type="text/css" href="../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="Accumulator (akiban-persistit 3.2.7 API)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/Accumulator.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../index-all.html">Index</a></li>
<li><a href="../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev Class</li>
<li><a href="../../com/persistit/Accumulator.Type.html" title="enum in com.persistit"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../index.html?com/persistit/Accumulator.html" target="_top">Frames</a></li>
<li><a href="Accumulator.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_class_summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.persistit</div>
<h2 title="Class Accumulator" class="title">Class Accumulator</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li>com.persistit.Accumulator</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public abstract class <span class="strong">Accumulator</span>
extends <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></pre>
<div class="block"><p>
 An Accumulator accumulates statistical information in the MVCC Transaction
 environment without creating write-write dependency conflicts. Subclasses
 include <code>SumAccumulator</code>, <code>MinAccumulator</code>,
 <code>MaxAccumulator</code> and <code>SeqAccumulator</code> which compute the
 sum, minimum and maximum values of contributions by individual transactions.
 (See below for semantics of the <code>SeqAccummulator</code>.) Each
 contribution is accounted for separately as a <code>Delta</code> instance
 until the transaction is either committed or aborted and there are no other
 concurrently executing transactions that started before the commit timestamp.
 This mechanism is designed to provide a "snapshot" view of the Accumulator
 that is consistent with the snapshot view of the database.
 </p>
 <p>
 In more detail: the <a href="../../com/persistit/Accumulator.html#update(long, com.persistit.Transaction)"><code>update(long, com.persistit.Transaction)</code></a> method of an Accumulator is invoked
 within the scope of a transaction T. That update is not visible to any other
 transaction until T commits. Moreover, any other concurrently executing
 transaction having a start timestamp less than T's commit timestamp does not
 see the results of the update. To accomplish this, the state of the
 Accumulator visible within a transaction is computed by determining which
 updates are visible and aggregating them on demand.
 </p>
 <p>
 The updates invoked on committed Transactions are recorded in the Journal and
 reapplied during recovery to reproduce an accurate version of the Accumulator
 state when Persistit starts up. There can be at most 64 Accumulators per
 Tree. A snapshot value of each Accumulator is stored once per checkpoint.
 Checkpoint snapshot values are held in the directory tree of the volume
 containing the Tree.
 </p>
 <p>
 The following defines intended use cases for the various types of
 accumulators:
 <dl>
 <dt>SUM</dt>
 <dd>Row count, total size, sums of various other characteristics</dd>
 <dt>MAX</dt>
 <dd>Maximum value</dd>
 <dt>MIN</dt>
 <dd>Minimum value</dd>
 <dt>SEQ</dt>
 <dd>Sequence number generation, e.g., auto-increment or internal primary key
 assignment
 </dl>
 </p>
 <p>
 The <code>SeqAccumulator</code> is a combination of
 <code>SumAccumulator</code> and <code>MaxAccumulator</code>. When the
 <a href="../../com/persistit/Accumulator.html#update(long, com.persistit.Transaction)"><code>update(long, com.persistit.Transaction)</code></a> method is called, the supplied long value is atomically added
 to the Accumulator's <code>live</code> value and the result is returned. In
 addition, a <code>Delta</code> holding the resulting sum as a proposed
 maximum value is added to the transaction. These semantics guarantee that
 every value returned by a SeqAccumulator is unique, and that upon recovery
 after a crash, the first value returned will be larger than the maximum value
 assigned by any transaction that committed successfully before the crash.
 Note that a transaction that assigns value and then aborts will leave a gap
 in the numerical sequence.
 </p></div>
<dl><dt><span class="strong">Author:</span></dt>
  <dd>peter</dd></dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested_class_summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Nested Class Summary table, listing nested classes, and an explanation">
<caption><span>Nested Classes</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Class and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/Accumulator.Type.html" title="enum in com.persistit">Accumulator.Type</a></strong></code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/Accumulator.html#getLiveValue()">getLiveValue</a></strong>()</code>
<div class="block">Non-transactional view aggregating all updates applied to this
 Accumulator, whether committed or not.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/Accumulator.html#getSnapshotValue(com.persistit.Transaction)">getSnapshotValue</a></strong>(<a href="../../com/persistit/Transaction.html" title="class in com.persistit">Transaction</a>&nbsp;txn)</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="http://download.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/Accumulator.html#toString()">toString</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/Accumulator.html#update(long, com.persistit.Transaction)">update</a></strong>(long&nbsp;value,
      <a href="../../com/persistit/Transaction.html" title="class in com.persistit">Transaction</a>&nbsp;txn)</code>
<div class="block">Update the Accumulator by contributing a value.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#clone()" title="class or interface in java.lang">clone</a>, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#equals(java.lang.Object)" title="class or interface in java.lang">equals</a>, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#finalize()" title="class or interface in java.lang">finalize</a>, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#getClass()" title="class or interface in java.lang">getClass</a>, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#hashCode()" title="class or interface in java.lang">hashCode</a>, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notify()" title="class or interface in java.lang">notify</a>, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notifyAll()" title="class or interface in java.lang">notifyAll</a>, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait()" title="class or interface in java.lang">wait</a>, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long)" title="class or interface in java.lang">wait</a>, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long, int)" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="getLiveValue()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getLiveValue</h4>
<pre>public&nbsp;long&nbsp;getLiveValue()</pre>
<div class="block">Non-transactional view aggregating all updates applied to this
 Accumulator, whether committed or not.</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>the live value</dd></dl>
</li>
</ul>
<a name="getSnapshotValue(com.persistit.Transaction)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getSnapshotValue</h4>
<pre>public&nbsp;long&nbsp;getSnapshotValue(<a href="../../com/persistit/Transaction.html" title="class in com.persistit">Transaction</a>&nbsp;txn)
                      throws <a href="../../com/persistit/exception/PersistitInterruptedException.html" title="class in com.persistit.exception">PersistitInterruptedException</a></pre>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>txn</code> - The transaction reading the snapshot</dd>
<dt><span class="strong">Returns:</span></dt><dd>The value computed by accumulating values contributed by (a) all
         transactions having commit timestamps less than or equal to
         <code>transaction</code>'s start timestamp, and (b) all
         operations performed by the current transaction having step
         numbers equal to or less than the <code>transaction</code>'s
         current step.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://download.oracle.com/javase/6/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a></code></dd>
<dd><code><a href="../../com/persistit/exception/PersistitInterruptedException.html" title="class in com.persistit.exception">PersistitInterruptedException</a></code></dd></dl>
</li>
</ul>
<a name="update(long, com.persistit.Transaction)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>update</h4>
<pre>public&nbsp;long&nbsp;update(long&nbsp;value,
          <a href="../../com/persistit/Transaction.html" title="class in com.persistit">Transaction</a>&nbsp;txn)</pre>
<div class="block">Update the Accumulator by contributing a value. The contribution is
 immediately accumulated into the live value, and it is also posted with a
 <code>Delta</code>instance to the supplied <a href="../../com/persistit/Transaction.html" title="class in com.persistit"><code>Transaction</code></a>. This
 method may be called only within the scope of an active
 <code>Transaction</code>.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>value</code> - The delta value</dd><dd><code>txn</code> - The transaction it applies to</dd></dl>
</li>
</ul>
<a name="toString()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>toString</h4>
<pre>public&nbsp;<a href="http://download.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;toString()</pre>
<dl>
<dt><strong>Overrides:</strong></dt>
<dd><code><a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#toString()" title="class or interface in java.lang">toString</a></code>&nbsp;in class&nbsp;<code><a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></code></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/Accumulator.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../index-all.html">Index</a></li>
<li><a href="../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev Class</li>
<li><a href="../../com/persistit/Accumulator.Type.html" title="enum in com.persistit"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../index.html?com/persistit/Accumulator.html" target="_top">Frames</a></li>
<li><a href="Accumulator.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_class_summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2005-2013 <a href="http://www.akiban.com">Akiban Technologies, Inc</a>. All Rights Reserved.</small></p>
</body>
</html>
